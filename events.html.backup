<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Veranstaltungen ‚Äì Vorchdorf</title>
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 0; background: #f7f7f8; color: #222; }
    header { display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: #ffffff; border-bottom: 1px solid #eee; position: sticky; top: 0; z-index: 10; }
    header a { text-decoration: none; color: #0366d6; font-weight: 600; }
    main { padding: 12px 16px; }
    .controls { display: flex; gap: 8px; align-items: center; margin-bottom: 12px; flex-wrap: wrap; }
    .input { flex: 1; min-width: 200px; padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 15px; }
    .btn { padding: 10px 16px; border: 1px solid #ddd; border-radius: 8px; background: #fff; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s; }
    .btn:hover { background: #f5f5f5; }
    .btn.active { background: #0366d6; color: #fff; border-color: #0366d6; }
    .list { display: grid; gap: 10px; }
    .card { background: #fff; border: 1px solid #eee; border-radius: 12px; padding: 12px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
    .title { font-weight: 700; margin-bottom: 6px; }
    .meta { font-size: 13px; color: #555; margin-bottom: 6px; }
    .desc { font-size: 14px; color: #333; }
    .empty { padding: 16px; font-size: 14px; color: #666; }
    
    /* Calendar Styles */
    .calendar { display: none; }
    .calendar.active { display: block; }
    .list.active { display: grid; }
    .list:not(.active) { display: none; }
    .cal-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; padding: 12px; background: #fff; border-radius: 12px; }
    .cal-nav { display: flex; gap: 8px; }
    .cal-nav button { padding: 8px 12px; border: 1px solid #ddd; border-radius: 8px; background: #fff; cursor: pointer; font-weight: 500; }
    .cal-nav button:hover { background: #f5f5f5; }
    .cal-month { font-size: 18px; font-weight: 700; }
    .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
    .cal-day-header { text-align: center; padding: 8px; font-size: 12px; font-weight: 600; color: #666; }
    .cal-day { background: #fff; border: 1px solid #eee; border-radius: 8px; min-height: 80px; padding: 4px; position: relative; cursor: pointer; transition: all 0.2s; }
    .cal-day:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .cal-day.other-month { opacity: 0.3; }
    .cal-day.today { border-color: #0366d6; border-width: 2px; }
    .cal-day-num { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
    .cal-event { font-size: 11px; background: #e0f2fe; color: #0369a1; padding: 2px 4px; border-radius: 4px; margin-bottom: 2px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .cal-event:hover { background: #bae6fd; }
    
    @media (prefers-color-scheme: dark) {
      body { background: #0b0b0d; color: #ddd; }
      header { background: #111; border-bottom-color: #222; }
      .card, .cal-header, .cal-day, .cal-nav button, .btn { background: #121212; border-color: #222; }
      .input, .btn { background: #111; border-color: #222; color: #ddd; }
      .btn:hover, .cal-nav button:hover { background: #1a1a1a; }
      .btn.active { background: #0366d6; color: #fff; }
      .cal-event { background: #1e3a5f; color: #60a5fa; }
      .cal-event:hover { background: #2a4a7c; }
    }
  </style>
</head>
<body>
  <header>
    <a href="./index.html">‚Üê Zur√ºck zur Vorchdorf App</a>
    <div style="font-weight:700;">Veranstaltungen</div>
  </header>
  <main>
    <div class="controls">
      <input id="search" class="input" type="search" placeholder="Suche nach Titel, Ort, Datum‚Ä¶" />
      <button id="btnCalendar" class="btn active">üìÖ Kalender</button>
      <button id="btnList" class="btn">üìã Liste</button>
    </div>
    
    <div id="calendar" class="calendar active">
      <div class="cal-header">
        <div class="cal-month" id="calMonth"></div>
        <div class="cal-nav">
          <button id="prevMonth">‚Äπ Zur√ºck</button>
    const listEl = document.getElementById('list');
    const emptyEl = document.getElementById('empty');
    const searchEl = document.getElementById('search');
    const calendarEl = document.getElementById('calendar');
    const btnCalendar = document.getElementById('btnCalendar');
    const btnList = document.getElementById('btnList');
    const calMonthEl = document.getElementById('calMonth');
    const calGridEl = document.getElementById('calGrid');
    const prevMonthBtn = document.getElementById('prevMonth');
    const nextMonthBtn = document.getElementById('nextMonth');
    const todayBtn = document.getElementById('today');
    
    let events = [];
    let currentView = 'calendar';
    let currentDate = new Date();
      <div class="cal-grid" id="calGrid"></div>
    </div>
    
    <div id="list" class="list"></div>
    <div id="empty" class="empty" style="display:none;">Keine Veranstaltungen gefunden.</div>
  </main>

  <script>
    // Google Sheets CSV Endpoint (bereits ver√∂ffentlicht)
    const SHEETS_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR6Pi8u-l21PXA8Qls1zBJK1Y5XWDmdwr5TLgioOuWSRhhoToDG1tmHt8NBR7S7jqn10WdHIk1zhK7g/pub?output=csv';

    const listEl = document.getElementById('list');
    const emptyEl = document.getElementById('empty');
    const searchEl = document.getElementById('search');
    let events = [];

    function normalizeDate(val) {
      if (!val) return null;
      if (typeof val === 'string') {
        // Try DD.MM.YYYY format
        const match = val.match(/(\d{1,2})\.(\d{1,2})\.(\d{4})/);
        if (match) {
          return new Date(Number(match[3]), Number(match[2]) - 1, Number(match[1]));
        }
        const d = new Date(val);
        return isNaN(d) ? null : d;
      }
      if (typeof val === 'number') return new Date(val);
      return null;
    }

    function formatDate(d) {
      if (!d) return '';
      return d.toLocaleDateString('de-AT', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' });
    }

    function parseCSV(text) {
      const lines = text.trim().split('\n');
      if (lines.length < 2) return [];
      const headers = lines[0].split(',').map(h => h.trim().toLowerCase().replace(/^"|"$/g, ''));
      const idx = {
        date: headers.findIndex(h => h.includes('datum') || h.includes('date')),
        title: headers.findIndex(h => h.includes('titel') || h.includes('title') || h.includes('event') || h.includes('veranstaltung')),
        location: headers.findIndex(h => h.includes('ort') || h.includes('location') || h.includes('place')),
        link: headers.findIndex(h => h.includes('link') || h.includes('url')),
        description: headers.findIndex(h => h.includes('beschreibung') || h.includes('desc')),
      };
      const rows = lines.slice(1).map(line => {
        const cols = line.split(',').map(c => c.trim().replace(/^"|"$/g, ''));
        const dateVal = idx.date >= 0 ? cols[idx.date] : '';
        const date = normalizeDate(dateVal);
        return {
          date,
          title: idx.title >= 0 ? cols[idx.title] : '',
          location: idx.location >= 0 ? cols[idx.location] : '',
          link: idx.link >= 0 ? cols[idx.link] : '',
          description: idx.description >= 0 ? cols[idx.description] : '',
        };
      });
      return rows.filter(e => e.title).sort((a, b) => {
        const ad = a.date ? a.date.getTime() : 0;
        const bd = b.date ? b.date.getTime() : 0;
        return ad - bd;
      });
    }

    function render(list) {
      listEl.innerHTML = '';
      if (!list || list.length === 0) {
        emptyEl.style.display = 'block';
        return;
      }
      emptyEl.style.display = 'none';
      list.forEach(ev => {
        const card = document.createElement('div');
        card.className = 'card';
        const title = document.createElement('div');
        title.className = 'title';
        title.textContent = ev.title;
        const meta = document.createElement('div');
        meta.className = 'meta';
        const parts = [formatDate(ev.date), ev.location].filter(Boolean);
        meta.textContent = parts.join(' ‚Ä¢ ');
        const desc = document.createElement('div');
        desc.className = 'desc';
        desc.textContent = ev.description || '';
        card.appendChild(title);
        card.appendChild(meta);
        card.appendChild(desc);
        if (ev.link) {
          const a = document.createElement('a');
          a.href = ev.link;
          a.textContent = 'Mehr Infos';
          a.target = '_blank';
          a.rel = 'noopener noreferrer';
          a.style.display = 'inline-block';
          a.style.marginTop = '8px';
          card.appendChild(a);
        }
        listEl.appendChild(card);
    async function init() {
      try {
        const res = await fetch(SHEETS_CSV_URL);
        const text = await res.text();
        events = parseCSV(text);
        renderCalendar();
      } catch (e) {
        console.error('Fehler beim Laden der Veranstaltungen:', e);
        emptyEl.style.display = 'block';
        emptyEl.textContent = 'Fehler beim Laden der Daten.';
      }
    }sync function init() {
      try {
    function renderCalendar(filteredEvents = null) {
      const eventsToShow = filteredEvents || events;
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      
      calMonthEl.textContent = currentDate.toLocaleDateString('de-AT', { year: 'numeric', month: 'long' });
      
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const prevLastDay = new Date(year, month, 0);
      
      const firstDayWeek = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1;
      const lastDayDate = lastDay.getDate();
      const prevLastDayDate = prevLastDay.getDate();
      
      const days = ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'];
      let html = days.map(d => `<div class="cal-day-header">${d}</div>`).join('');
      
      const today = new Date();
      const isToday = (d, m, y) => d === today.getDate() && m === today.getMonth() && y === today.getFullYear();
      
      // Previous month days
      for (let i = firstDayWeek - 1; i >= 0; i--) {
        const day = prevLastDayDate - i;
        html += `<div class="cal-day other-month"><div class="cal-day-num">${day}</div></div>`;
      }
      
      // Current month days
      for (let day = 1; day <= lastDayDate; day++) {
        const date = new Date(year, month, day);
        const dateStr = date.toISOString().split('T')[0];
        const dayEvents = eventsToShow.filter(e => e.date && e.date.toISOString().split('T')[0] === dateStr);
        const todayClass = isToday(day, month, year) ? ' today' : '';
        
        html += `<div class="cal-day${todayClass}" data-date="${dateStr}">
          <div class="cal-day-num">${day}</div>`;
        
        dayEvents.slice(0, 3).forEach(ev => {
          html += `<div class="cal-event" title="${ev.title}">${ev.title}</div>`;
        });
        
        if (dayEvents.length > 3) {
          html += `<div class="cal-event">+${dayEvents.length - 3} mehr</div>`;
        }
        
        html += `</div>`;
      }
      
      // Next month days
      const remainingDays = 42 - (firstDayWeek + lastDayDate);
      for (let day = 1; day <= remainingDays; day++) {
        html += `<div class="cal-day other-month"><div class="cal-day-num">${day}</div></div>`;
      }
      
      calGridEl.innerHTML = html;
      
      // Add click handlers
      document.querySelectorAll('.cal-day:not(.other-month)').forEach(dayEl => {
        dayEl.addEventListener('click', (e) => {
          const dateStr = dayEl.dataset.date;
          const dayEvents = events.filter(ev => ev.date && ev.date.toISOString().split('T')[0] === dateStr);
          if (dayEvents.length > 0) {
            switchToList();
            searchEl.value = dayEvents[0].date.toLocaleDateString('de-AT');
            applySearch();
          }
        });
      });
    }
    
    function switchToCalendar() {
      currentView = 'calendar';
      calendarEl.classList.add('active');
      listEl.classList.remove('active');
      btnCalendar.classList.add('active');
      btnList.classList.remove('active');
      renderCalendar();
    }
    
    function switchToList() {
      currentView = 'list';
      calendarEl.classList.remove('active');
      listEl.classList.add('active');
      btnCalendar.classList.remove('active');
      btnList.classList.add('active');
      applySearch();
    }
    
    btnCalendar.addEventListener('click', switchToCalendar);
    btnList.addEventListener('click', switchToList);
    
    prevMonthBtn.addEventListener('click', () => {
      currentDate.setMonth(currentDate.getMonth() - 1);
      renderCalendar();
    });
    
    nextMonthBtn.addEventListener('click', () => {
      currentDate.setMonth(currentDate.getMonth() + 1);
      renderCalendar();
    });
    
    todayBtn.addEventListener('click', () => {
      currentDate = new Date();
      renderCalendar();
    });
    
    searchEl.addEventListener('input', applySearch);
    
    init();st text = await res.text();
        events = parseCSV(text);
        render(events);
      } catch (e) {
        console.error('Fehler beim Laden der Veranstaltungen:', e);
        emptyEl.style.display = 'block';
        emptyEl.textContent = 'Fehler beim Laden der Daten.';
      }
    }

    searchEl.addEventListener('input', applySearch);
    init();
  </script>
</body>
</html>
